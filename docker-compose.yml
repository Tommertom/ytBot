version: "3.8"

services:
  coderbot:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: coderbot-instance
    volumes:
      - ./logs:/app/logs
      - coderbot-media:/tmp/coderBOT_media
      - ./.env:/app/.env:ro
    restart: unless-stopped
    tty: true
    stdin_open: true

volumes:
  coderbot-media:

      # Media folders for each bot worker
      - ./media:/tmp/coderBOT_media

      # Optional: Persist terminal history
      - terminal_history:/home/node

      # Optional: Mount a working directory for file operations
      - bot_workspace:/workspace

      # Optional: Persist GitHub CLI authentication (for Copilot CLI)
      - gh_config:/home/node/.config/gh

    # Resource limits (adjust based on your needs)
    deploy:
      resources:
        limits:
          cpus: "2.0"
          memory: 2G
        reservations:
          cpus: "0.5"
          memory: 512M

    # Security options
    security_opt:
      - no-new-privileges:true

    # Network configuration
    network_mode: "bridge"

    # Health check (optional)
    healthcheck:
      test: ["CMD", "node", "-e", "process.exit(0)"]
      interval: 60s
      timeout: 10s
      retries: 3
      start_period: 60s

volumes:
  terminal_history:
    driver: local
  bot_workspace:
    driver: local
  gh_config:
    driver: local
